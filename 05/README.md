# 第 5 章 虚拟机的安装和使用

|本期版本|上期版本|
|:---:|:---:|
`Tue Aug 20 18:05:52 CST 2024` | -

## 5.1 计算机的启动过程


### 5.1.2 计算机的加电和复位

* ~~复位将使代码段寄存器（CS）的内容为 `0xFFFF`, 其他所有寄存器的内容为 `0x0000`~~

### 5.1.3 基本输入输出系统

* 处理器取指令的自然顺序是从内存的低地址往高地址推进

### 5.1.4 硬盘及其工作原理

* 扇区与扇区之间以间隙（空白）间隔开来，每个扇区以扇区头开始，然后是 **512** 字节的数据区


### 5.1.5 一切从主引导扇区开始

* 硬盘的第一个扇区是 0 面 0 道 1 扇区，或者说是 0 头 0 柱 1 扇区，这个扇区称为 `主引导扇区`
* ROM-BIOS 将读取主引导扇区的内容，将它加载到内存地址  `0x0000:0x7C00`(也就是物理地址是`0x07C00`)

```asm
jmp 0x0000:0x7c00
```

## 5.2  创建和使用虚拟机

### 5.2.3 虚拟硬盘简介

* 硬盘的读写是以扇区为最小单位的。所以无论什么时候，要从硬盘读数据，或者向硬盘写数据，至少得是 1 个扇区

```bash
# 4MB = 4 * 1024 * 1024 = 4194816D = 0400200H
# 4194816 - 512 = 4194304

VBoxManage createmedium disk --filename demo --format VHD --variant Fixed --size 4
hexdump -s 4194304 -n 512 -C demo.vhd
```


### 5.2.4 练习使用 FixVhdWr 工具向虚拟硬盘写入数据

```bash
dd if=mbr.bin of=c.img bs=512 count=1 seek=100 conv=notrunc
```

* 通常，一个扇区的尺寸是512字节, 可以看成一个数据块
* 采用磁头、磁道和扇区这种模式来访问硬盘的方法称为 `CHS模式`
* 逻辑块地址（Logical Block Address, LBA)